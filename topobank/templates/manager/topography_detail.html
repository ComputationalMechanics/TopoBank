{% extends 'base.html' %}
{% load static i18n %}
{% load fontawesome %}

{% block content-title %}Details for Topography <i>{{ topography.name }}</i>
{% endblock content-title %}

{% block breadcrumbs %}
  <li class="breadcrumb-item">
    <a href="{% url 'manager:surface-list' %}">Surfaces</a>
  </li>
  <li class="breadcrumb-item">
    <a href="{% url 'manager:surface-detail' topography.surface.id %}">{{ topography.surface.name }}</a>
  </li>
  <li class="breadcrumb-item active" aria-current="page">
    Topography <em>{{ topography.name }}</em>
  </li>
{% endblock breadcrumbs %}

{% block extra_css %}
<link
    href="https://cdn.pydata.org/bokeh/release/bokeh-1.0.1.min.css"
    rel="stylesheet" type="text/css">
<link
    href="https://cdn.pydata.org/bokeh/release/bokeh-widgets-1.0.1.min.css"
    rel="stylesheet" type="text/css">
<link
    href="https://cdn.pydata.org/bokeh/release/bokeh-tables-1.0.1.min.css"
    rel="stylesheet" type="text/css">
{% endblock extra_css %}

{% block content %}
<div class="card text-center container-fluid">
  <div class="card-header">

    <h2>
      <div class="pull-left">
        <h1>{{ topography.name }}</h1>
      </div>
      <div class="pull-right">
        <a href="{% url 'manager:topography-delete' topography.id %}" class="btn btn-danger">
            {% fontawesome_icon 'trash' %} Delete
        </a>
        <span></span>
        <a href="{% url 'manager:topography-update' topography.id %}" class="btn btn-default">
            {% fontawesome_icon 'edit' %} Edit
        </a>
      </div>
     </h2>
  </div>
  <div class="card-body">

    <ul class="nav nav-tabs">
      <li class="nav-item">
        <a class="nav-link active" data-toggle="tab" href="#plot" role="tab">Topography</a>
      </li>

      <li class="nav-item">
        <a class="nav-link" data-toggle="tab" href="#meta" role="tab">Properties</a>
      </li>

    </ul>

    <div class="tab-content">

      <div class="tab-pane fade active show" id="plot" role="tabpanel" aria-labelledby="plot-tab">
        {{ image_plot_div|safe }}
      </div>

      <div class="tab-pane fade" id="meta" role="tabpanel" aria-labelledby="meta-tab">
        <table class="table table-responsive text-left">
          <tbody>
            <tr>
              <th scope="row">Surface</th>
              <td><a href="{% url 'manager:surface-detail' topography.surface.id %}">{{ topography.surface.name }}</a></td>
            </tr>
            <tr>
              <th scope="row">Measurement Date</th>
              <td>{{ topography.measurement_date }}</td>
            </tr>
            <tr>
              <th scope="row">Name of Data File</th>
              <td>{{ topography.datafile.name }}</td>
            </tr>
            <tr>
              <th scope="row">Data Source</th>
              <td>{{ topography.data_source }}</td>
            </tr>
            <tr>
              <th scope="row">Description</th>
              <td>{{ topography.description }}</td>
            </tr>
            <tr>
              <th scope="row">Physical Size</th>
              <td>{{ topography.size_x }} {{ topography.size_unit }} x {{ topography.size_y }} {{ topography.size_unit }}
              </td>
            </tr>
            <tr>
              <th scope="row">Height Conversion Factor</th>
              <td>{{ topography.height_scale }} {{ topography.height_unit }}</td>
            </tr>
            <tr>
              <th scope="row">Detrending Mode</th>
              <td>{{ topography.get_detrend_mode_display }}</td>
            </tr>
            <tr>
              <th scope="row">Resolution</th>
              <td>{{ topography.resolution_x }} x {{ topography.resolution_y }}</td>
            </tr>
          </tbody>
        </table>
      </div>

    </div>

  </div>
</div>

{% endblock content %}

{% block javascript %}

<!-- ----------- for bokeh plot ----- -->
<script src="https://cdn.pydata.org/bokeh/release/bokeh-1.0.1.min.js"></script>
<script src="https://cdn.pydata.org/bokeh/release/bokeh-widgets-1.0.1.min.js"></script>
<script src="https://cdn.pydata.org/bokeh/release/bokeh-tables-1.0.1.min.js"></script>{#  TODO not needed so far #}

{{ image_plot_script | safe }}

 <!-- ----------- for zoomable image ----- -->
<script src="{% static 'vendor/openseadragon-bin-2.4.0/openseadragon.min.js' %}"></script>
<script type="text/javascript">
  {% if topography.dzi_file %}
  $(document).ready(function() {
    var viewer = OpenSeadragon({
      id: "zoomable-topography-image",
      prefixUrl: "{% static 'vendor/openseadragon-bin-2.4.0/images/' %}",
      tileSources: "{{ topography.dzi_file.url }}"
    });

    // We need to set the height of the div in order that sth is shown (at least Firefox)
    var canvas = $(".openseadragon-canvas > canvas:nth-child(1)");
    var div_height = canvas.width() / {{ topography.size_x }} * {{ topography.size_y }} * 0.6;
    $('#zoomable-topography-image').height(div_height);
    console.log('div_height for zoomable image:'+div_height)
  });
  {% else %}
    $('#zoomable-topography-image').text("Zoomable image not yet available.")
  {% endif %}
</script>
{% endblock %}

