{% extends 'base.html' %}
{% load fontawesome %}
{% load surface_tags %}
{% load guardian_tags %}

{% block content-title %}Details for Surface <i>{{ surface.name }}</i>
{% endblock content-title %}

{% block breadcrumbs %}
  <li class="breadcrumb-item">
    <a href="{% url 'manager:surface-list' %}">Surfaces</a>
  </li>
  <li class="breadcrumb-item active" aria-current="page">
    {{ surface.name|truncatechars:50 }}
  </li>
{% endblock breadcrumbs %}

{% block content %}

  {% get_obj_perms request.user for surface as "surface_perms" %}

  <div class="card">

    <div class="card-header">

      <div class="pull-left">
        <h1>{{ surface.name }}</h1>

      </div>

      <ul class="nav nav-pills card-header-pills pull-right">
        <li class="nav-item">
          <a class="nav-link active" data-toggle="pill" href="#topographies" role="tab">Topographies</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-toggle="pill" href="#description" role="tab">Description</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-toggle="pill" href="#permissions" role="tab">Permissions</a>
        </li>
      </ul>
    </div>

    <div class="card-body">

      <div class="row">

        <div class="col-9">
          <div class="tab-content">

            <div class="tab-pane fade show active" id="topographies">
              <div id="bandwidths" class="surface-summary-plot">
              </div>
              <caption>Click on a bar in order to open the topography.</caption>
            </div>

            <div class="tab-pane fade" id="description">
              {{ surface.description }}
            </div>

            <div class="tab-pane fade" id="permissions">

              <table class="table table-responsive">
                <caption>Users having permissions regarding this surface.
                  Click <a href="{% url 'manager:sharing-info' %}">here</a> for information which surfaces are
                  shared with you or by you.
                </caption>
                <thead>
                {% for th in permission_table.head %}
                  <th>{{ th }}</th>
                {% endfor %}
                </thead>
                <tbody>
                {% for row in permission_table.body %}
                  <tr>
                    {% for cell_content, cell_title in row %}
                      <td>
                        {% if forloop.first %}
                          <span title="Click to view profile">{% fontawesome_icon 'user' %}
                        <a href="{{ cell_title }}">{{ cell_content }}</a>
                        {# a bit of a hack: cell_title is used to pass a link here #}
                        </span>
                        {% else %}
                          {% render_boolean cell_content cell_title %}
                        {% endif %}
                      </td>
                    {% endfor %}
                  </tr>
                {% endfor %}
                </tbody>
              </table>

            </div>

          </div>

        </div>

        <div class="col-3">

          <div class="row p-3">

            <div class="col">

              <div class="card-text">
                  <span class="badge badge-info surface-category-headline">
                  {{ surface.get_category_display|default_if_none:"category not defined yet" }}
                  </span>
                {% render_shared_by_badge request surface %}
              </div>

            </div>
          </div>
          <div class="row p-3">
            <div class="col">

              {% if "change_surface" in surface_perms %}
                <a href="{% url 'manager:surface-update' surface.id %}" class="btn btn-default btn-block btn-lg">
                  {% fontawesome_icon 'edit' %} Edit meta data
                </a>
              {% endif %}

              {% if "change_surface" in surface_perms %}
                <a href="{% url 'manager:topography-create' surface.id %}" class="btn btn-default btn-block btn-lg">
                  {% fontawesome_icon 'plus-square-o' %} Add Topography
                </a>
              {% endif %}


              {% if "share_surface" in surface_perms %}
                <a href="{% url 'manager:surface-share' surface.id %}" class="btn btn-default btn-block btn-lg">
                  {% fontawesome_icon 'share-alt' %} Share
                </a>
              {% endif %}

              {% if "delete_surface" in surface_perms %}
                <a href="{% url 'manager:surface-delete' surface.id %}"
                   class="btn btn-outline-danger btn-block btn-lg">
                  {% fontawesome_icon 'trash' %} Delete
                </a>
              {% endif %}
            </div>
          </div>
          <div class="row p-3">
            <div class="col">
                <a href="{% url 'manager:surface-list' %}"
                   class="btn btn-default btn-block btn-lg">
                  {% fontawesome_icon 'list' %} Back to search results
                </a>
            </div>
          </div>
        </div>

      </div>


    </div>
  </div>



{% endblock content %}

{% block javascript %}
  <script>
    $().ready(function () {
      //
      // Create surface summary plot
      //
      surface_summary_plot($("div#bandwidths"), {{ bandwidths_data|safe }});
    })
  </script>

{% endblock javascript %}


