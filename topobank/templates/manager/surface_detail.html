
{% extends 'base.html' %}
{% load fontawesome %}

{% block content-title %}Details for Surface <i>{{ surface.name }}</i>
{% endblock content-title %}

{% block content %}
<div class="card text-center container-fluid">
  <div class="card-header">

    <h2>
      <div class="pull-left">
      {%  with surface.thumbnail as thumbnail %}
      <img src="{{ thumbnail.url }}" alt="Thumbnail of surface image"
          width="{{ thumbnail.width }}"
          height="{{ thumbnail.height }}">
      {% endwith %}
      </div>
      <b>{{ surface.name }}</b>
      <div class="pull-right">
        <a href="{ url 'manager:surface-delete' surface.id }" class="btn btn-danger">
            {% fontawesome_icon 'trash' %} Delete
        </a>
        <span></span>
        <a href="{ url 'manager:surface-update' surface.id }" class="btn btn-default">
            {% fontawesome_icon 'edit' %} Edit
        </a>
        <a href="{% url 'manager:topography-create' surface.id %}" class="btn btn-default">
          {% fontawesome_icon 'plus-square-o' %} Add Topography
        </a>
      </div>
     </h2>
  </div>
  <div class="card-body">

    <ul class="nav nav-tabs">
      <li class="nav-item">
        <a class="nav-link active" data-toggle="tab" href="#topographies" role="tab">Topographies</a>
      </li>

      <li class="nav-item">
        <a class="nav-link" data-toggle="tab" href="#meta" role="tab">Meta Data</a>
      </li>
    </ul>


    <div class="tab-content">
      <div class="tab-pane fade show active" id="topographies" role="tabpanel" aria-labelledby="topographies-tab">

        <!--
        <div class="card-deck">
        {% for topo in surface.topography_set.all %}

            <div class="card mb-3">
              <div class="card-header">
                {{ topo.name }}
                <div class="pull-right">
                  <a href="{% url 'manager:topography-detail' topo.id %}" class="btn btn-primary">
                  Show Details
                  </a>
                </div>
              </div>
              <div class="card-body">

                 <img src="{{ topo.surface_thumbnail.url }}" alt="Thumbnail of topography
                       width="{{ topo.surface_thumbnail.width }}"
                       height="{{ topo.surface_thumbnail.height }}">
                {{ topo.description }}
                {{ topo.measurement_date }}
              </div>
            </div>

        {% endfor %}
        </div>
        -->

        <div class="table-responsive">
          <form>
          {%  csrf_token %}
          <table class="table table-hover">

            <thead>
            <tr>
              <th scope="col">Thumbnail</th>
              <th scope="col">Name</th>
              <th scope="col">Measurement Date</th>
              <th scope="col">Description</th>
              <th scope="col">
                  <div class="checkbox-inline">
                    <label><input id="select_all" type="checkbox" value=""></label>
                  </div>
              </th>
            </tr>
            </thead>
            <tbody>
            {% for topo in surface.topography_set.all %}
              <tr class="clickable-table-row" data-href="{% url 'manager:topography-detail' topo.id %}">

                <td><img src="{{ topo.surface_thumbnail.url }}" alt="Thumbnail of surface image"
                         width="{{ topo.surface_thumbnail.width }}"
                         height="{{ topo.surface_thumbnail.height }}"></td>
                <th scope="row">{{ topo.name }}</th>
                <td>{{ topo.measurement_date }}</td>
                <td>{{ topo.description }}</td>
                <td>
                  <div class="checkbox-inline">
                    <label><input class="cb-topography" id="toggle-select-topo-{{ topo.id }}" type="checkbox"
                                  is-selected-url="{% url 'manager:topography-is-selected' topo.id %}"
                                  data-href="{% url 'manager:topography-toggle-select' topo.id %}"></label>
                  </div>
                </td>
              </tr>
            {% endfor %}

            </tbody>
          </table>
          </form>
        </div>
      </div>

      <div class="tab-pane fade" id="meta" role="tabpanel" aria-labelledby="meta-tab">
        <table class="table table-responsive text-left">
          <tbody>
            <tr>
              <td>Name</td><td>{{ surface.name }}</td>
            </tr>
            <tr>
              <td><b>to be defined</b></td><td><b>to be defined</b></td>
            </tr>
          </tbody>
        </table>
      </div>

    </div>

  </div>
</div>

<div>
  Session: {{ request.session.selected_topographies }}
</div>

{% endblock content %}

{% block javascript %}
  <script>
  $('#select_all').change(function() {
      var checkboxes = $('.cb-topography');
      checkboxes.prop('checked', $(this).is(':checked'));
  });


  $('.cb-topography').change( function(e) {
      console.log(this);
      $.ajax($(this).attr("data-href"));
    }
  );

  // do not propagate click when selecting checkbox, so no details are shown
  $('.cb-topography').click( function(e) {
    e.stopPropagation();
  })

  $().ready(function(){
    $('.cb-topography').prop('checked', $.ajax($(this).attr("is-selected-url"))['is_selected']);
    console.log("initial selection ready");
  })
  </script>
{% endblock javascript %}


