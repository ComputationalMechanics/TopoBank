
{% extends 'base.html' %}
{% load fontawesome %}
{% load crispy_forms_tags %}
{% load surface_tags %}

{% block extra_css %}
  {{ form.media.css }}
{% endblock extra_css %}

{% block content-title %}
  My Surfaces and Topographies
  <div class="pull-right">
    <a href="{% url 'manager:surface-create' %}" class="btn btn-primary">
      {% fontawesome_icon 'plus-square-o' %} Add Surface
    </a>
  </div>
{% endblock content-title %}

{% block breadcrumbs %}
  <li class="breadcrumb-item active" aria-current="page">
    Surfaces
  </li>
{% endblock breadcrumbs %}

{% block searchbox %}
  <!-- Filter for topographies  -->
  <div class="bg-light border-top border-bottom">
    <div class="container-fluid">
      {% crispy form form.helper %}
    </div>
  </div>
{% endblock searchbox %}

{% block content %}

  <div class="row">
    {% for surface in surfaces %}
      {% selected_topographies request surface as selected_topographies_for_surface %}
      {% if selected_topographies_for_surface.exists %}
        <div class="col-xl-6 mb-4">
          <div class="card">
            <div class="card-header">
              <a href="{% url 'manager:surface-detail' surface.id %}"><b>{{ surface.name }}</b></a>

              <div class="pull-right">
                <a href="{% url 'manager:topography-create' surface.id %}" class="btn btn-primary">
                  {% fontawesome_icon 'plus-square-o' %} Add Topography
                </a>
              </div>
            </div>

            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover">
                  <tbody>
                  {% for topo in selected_topographies_for_surface %}
                    {% with topo.surface_thumbnail as thumbnail %}
                      <tr class="clickable-table-row"
                          data-href="{% url 'manager:topography-detail' topo.id %}">
                        <td><img src="{{ thumbnail.url }}" alt="Placeholder for topography thumbnail"
                                 width="{{ thumbnail.width }}"
                                 height="{{ thumbnail.height }}"></td>
                        <td>{{ topo.name }}</td>
                      </tr>
                    {% endwith %}
                  {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>

            <div class="card-footer">
              <small>selected {{ selected_topographies_for_surface|length }} out of {{ surface.num_topographies }}
                topographies
              </small>
            </div>
          </div>
        </div>
      {% endif %}
    {% endfor %}
  </div>


{% endblock content %}

{% block javascript %}
  {{ form.media.js }}
{% endblock javascript %}
