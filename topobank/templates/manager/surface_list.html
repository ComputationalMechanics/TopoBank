
{% extends 'base.html' %}
{% load fontawesome %}
{% load crispy_forms_tags %}
{% load surface_tags %}
{% load guardian_tags %}

{% block extra_css %}
  {{ form.media.css }}
{% endblock extra_css %}

{% block content-title %}
  My Surfaces and Topographies
  <div class="pull-right">
    <a href="{% url 'manager:surface-create' %}" class="btn btn-primary">
      {% fontawesome_icon 'plus-square-o' %} Add Surface
    </a>
  </div>
{% endblock content-title %}

{% block breadcrumbs %}
  <li class="breadcrumb-item active" aria-current="page">
    Surfaces
  </li>
{% endblock breadcrumbs %}

{% block searchbox %}
  <!-- Filter for topographies  -->
  <div class="bg-light border-top border-bottom">
    <div class="container-fluid">
      {% crispy form form.helper %}
    </div>
  </div>
{% endblock searchbox %}

{% block content %}

   <!--
  Show one card for each surface

  Will be replaced by AJAX call.
  -->
  <div class="row">
    {% for surface in surfaces %}
      <div class="col-xl-4 mb-4">
        <div id="card-{{ surface.id }}">
          <div class="card">
            <div class="card-header">
              <h4>{{ card.surface.name }}</h4>
            </div>
            <div class="card-body">
              <p>Please wait..</p>
              <div class="spinner"></div>
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>

{% endblock content %}

{% block javascript %}
  {{ form.media.js }}

  <script>

    /** Use this as start when loading new cards without form submission
    $('.django-select2').on('change.select2', function (e) {
       var data = e.params.data;
       console.log("select, data "+data);
       console.dir(data);
    });
    */

    // for each surface submit ajax call to insert a bootstrap card
    $(document).ready(function () {
      {% url 'manager:surface-card' as card_url %}
      {% for surface in surfaces %}
        submit_surface_card_ajax("{{ card_url }}", {{ surface.id }}, "{{ request.path }}");
      {% endfor %}
    });

    // we don't want error messages if the page is left before everything is loaded
    install_handler_for_aborting_all_ajax_calls_on_page_leave();
  </script>
{% endblock javascript %}
